{{extend 'layout.html'}}

<h2>Taxa</h2>
{{=DIV(tnrs_url, _class='tnrsURL', _id="tnrsURL")}}
<table>
	<tr><th>Submitted Name</th><th>TNRS blurb</th><th>taxon URI</th></tr>
{{for name in name_row_list:}}<tr><td>{{=name.original_name}}</td><td>{{=DIV(name.tnrs_json, _class='tnrsJsonBlurb', _id=str(name.id))}}</td><td>{{=name.taxon_uri}}</td></tr>{{pass}}
</table>

<p>TNRS results are/will be from {{=A(tnrs_url, _href=tnrs_url, _class='tnrsURL', _id="tnrsURL")}}</p>

<script type="text/javascript">
$(document).ready(function(){
	var f = $(".tnrsJsonBlurb").first();
	if (f.text() == "") {
		var turl = $("#tnrsURL").text();
		f.text(turl);
		var xobj = new XMLHttpRequest();
		xobj.onreadystatechange = function() {
  			if (xobj.readyState==4) {
  				if ( xobj.status==200) {
    				f.text("success");
    			}
    			else {
					$(".flash").html("TNRS lookup failure.").slideDown();
					f.text("failure");
				}
    		}
  		}
		xobj.open('GET', turl, true);
    	xobj.setRequestHeader("Accept", "");
    	xobj.setRequestHeader("Content-Type","application/json");
    	xobj.send();
	}

});
</script>